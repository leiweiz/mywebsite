# encoding: utf-8
import urllib2
from bs4 import BeautifulSoup
import sys
reload(sys)
sys.setdefaultencoding("utf-8")

board = {
    '新闻中心': {
        '海外新闻': {
            '亚洲新闻': 'AsiaNews',
            '澳新新闻': 'AustraliaNews',
            '加拿大新闻': 'CanadaNews',
            '欧洲新闻': 'EuropeNews',
            '移民新闻': 'ImmigrationNews',
            '地区信息': 'LocalInfo',
            '海外焦点': 'OverseasFocus'
        },
        '财经新闻': 'BusinessNews',
        '中国新闻': 'ChinaNews',
        '中国新闻2': 'ChinaNews2',
        '侦探与执法': 'Detective',
        '捐赠及救助': 'Donation',
        '未名大事件': 'GreatPit',
        '焦点新闻': 'Headline',
        '史海钩沉': 'History',
        '军事天地': 'Military',
        '军事天地2': 'Military2',
        '时政新闻': 'MiscNews',
        '编辑专栏': 'MitbbsColumn',
        '中国近代史': 'Mod_CHN_Hist',
        '奥运版': 'Olympics',
        '娱乐新闻': 'PopNews',
        '酷儿新闻': 'QueerNews',
        '爱国强国': 'RisingChina',
        '希望的田野': 'RuralChina',
        '民主沙龙': 'Salon',
        '科技新闻': 'ScitechNews',
        '体育新闻': 'SportsNews',
        '众说纷纭': 'talk',
        '海峡两岸': 'TheStrait',
        '美国新闻': 'USANews',
        '全球瞭望': 'WorldNews'
    },
    '海外生活': {
        '移民讨论区': {
            'EB23': 'EB23',
            '申请移民签证': 'I140',
            '我要绿卡': 'I485',
            '移民': 'Immigration'
        },
        '车轮上的传奇': 'Automobile',
        '回国': 'BackHome',
        '证券中国': 'ChinaStock',
        '华人政治': 'CivilSociety',
        '分类广告': 'Classified',
        '电子商务': 'ebiz',
        '发考题': 'Faculty',
        '我爱我家': 'Family',
        '二手市场': 'FleaMarket',
        '画饼充饥': 'Food',
        '吉福卡': 'GiftCard',
        '大话西游': 'Gowest',
        '音像天地': 'HiFi',
        '房屋出租/求租': 'HouseRental',
        '投资': 'Investment',
        '待字闺中': 'JobHunting',
        '求职': 'JobMarket',
        '家居生活': 'Living',
        '求医问药': 'Medicine',
        '海外中国教育基金会': 'mitOCEF',
        '海外理财': 'Money',
        '我爱宝宝': 'NextGeneration',
        '瞟杨过，孩触过六穴': 'Overseas',
        '为人父母': 'Parenting',
        '省钱一族': 'PennySaver',
        '博士后': 'Postdoc',
        '海归': 'Returnee',
        '探亲与陪读': 'Reunion',
        '海外代购': 'SellAbroad',
        '购物天堂': 'shopping',
        '创业': 'StartUp',
        '股海弄潮': 'Stock',
        '交税与退税': 'TAX',
        '签证': 'Visa',
        '北美联合律师事务所专栏': 'WeGreened',
        '上班一族': 'Working'
    },
    '华人世界': {
        '美国': {
            '阿拉巴马': 'Alabama',
            '亚利桑那': 'Arizona',
            '阿肯色': 'ARKANSAS',
            '波士顿地区': 'Boston',
            '南北卡地区': 'Carolinas',
            '芝加哥地区': 'Chicago',
            '科罗拉多': 'Colorado',
            '康涅狄格': 'Connecticut',
            '佛罗里达州': 'Florida',
            '佐治亚州': 'Georgia',
            '夏威夷': 'Hawaii',
            '爱达荷州': 'IDAHO',
            '印第安纳': 'Indiana',
            '爱荷华': 'Iowa',
            '堪萨斯': 'Kansas',
            '肯塔基': 'Kentucky',
            '洛杉基地区': 'LosAngeles',
            '路易斯安娜': 'Louisiana',
            '马里兰州': 'Maryland',
            '密歇根': 'Michigan',
            '明尼苏达': 'Minnesota',
            '密西西比': 'Mississippi',
            '密苏里': 'Missouri',
            '内布拉斯加': 'Nebraska',
            '内华达': 'Nevada',
            '新泽西': 'NewJersey',
            '新墨西哥': 'NewMexico',
            '纽约地区': 'NewYork',
            '俄亥俄州': 'Ohio',
            '俄克拉和马': 'Oklahoma',
            '俄勒冈': 'Oregon',
            '费城地区': 'PHILADELPHIA',
            '痞子堡': 'Pittsburgh',
            '罗德岛': 'RhodeIsland',
            '圣迭戈': 'SanDiego',
            '三藩市地区': 'SanFrancisco',
            '西雅图地区': 'Seattle',
            '田纳西': 'Tennessee',
            '德克萨斯州': 'Texas',
            '美国新闻': 'USANews',
            '犹他州': 'Utah',
            '维吉尼亚州': 'Virginia',
            '华盛顿特区': 'WashingtonDC',
            '威斯康星': 'Wisconsin'
        },
        '加拿大': 'mitbbs_bbsboa',
        '澳大利亚': 'Australia',
        '海外华人': 'Chinese',
        '欧家大院': 'Europe',
        '德意志': 'Germany',
        '东方之珠': 'HongKong',
        '日本': 'Japan',
        '阿尼哈撒哟': 'Korea',
        '中国大陆': 'Mainland',
        '新西兰': 'NewZealand',
        '新加坡': 'Singapore',
        '瑞士': 'Switzerland',
        '美丽之岛': 'Taiwan',
        '英国': 'UnitedKingdom'
    },
    '体育健身': {
        '霸王上硬弓': 'Archery',
        '羽毛球': 'Badminton',
        '棒球': 'Baseball',
        '篮球': 'Basketball',
        '台球': 'Billiards',
        '桥牌': 'Bridge',
        '象棋': 'Chess',
        '自行车运动': 'Cycling',
        '曲棍球': 'FieldHockey',
        '一天到晚上钩的鱼': 'Fishing',
        '健身俱乐部': 'Fitness',
        '橄榄球': 'Football',
        '虚拟人生': 'Game',
        '黑白子': 'Go',
        '高尔夫': 'Golf',
        '舞刀弄枪': 'GunsAndGears',
        '冰球': 'Hockey',
        '健康减肥': 'loseweight',
        '武术': 'MartialArts',
        '麻雀学园': 'MJ',
        'NBA': 'NBA',
        '大学体育': 'NCAA',
        '奥运版': 'Olympics',
        '户外活动': 'Outdoors',
        '彩弹': 'Paint_ball',
        '掌上乐园': 'PalmParadise',
        '翱翔蓝天': 'Pilot',
        '乒乓球': 'Pingpong',
        '风驰电掣': 'Racing',
        '跑步不息': 'Running',
        '雪山飞弧': 'Ski',
        '滚吧，足球！': 'Soccer',
        '体育新闻': 'SportsNews',
        '碧水闲情': 'Swimming',
        '网球': 'Tennis',
        '德州扑克': 'TexasHoldem',
        '四海为家': 'Travel',
        '三项全能': 'Tri',
        '视频游戏': 'TVGame',
        '排球': 'VolleyBall',
        '举重若轻': 'Weightlifting',
        '未名游戏': 'WmGame',
        '瑜伽&普拉提': 'yoga',
        '尊巴': 'Zumba'
    },
    '休闲娱乐': {
        '动物园': 'Animals',
        '星座物语': 'astrology',
        '听书馆': 'AudioBook',
        '未名形象秀': 'Avatar',
        '娱乐八卦': 'bagua',
        '大脑工作室': 'BrainTeaser',
        '古典音乐': 'ClassicalMusic',
        '收藏': 'Collectibles',
        '美国电视': 'CouchPotato',
        '手工艺': 'Craft',
        '轻舞飞扬': 'Dance',
        'DVD': 'DVD',
        '电子竞技': 'E-Sports',
        '淘珍换宝': 'Exchange',
        '美丽时尚': 'Fashion',
        '一天到晚上钩的鱼': 'Fishing',
        '博彩': 'Gamble',
        '虚拟人生': 'Game',
        '拈花惹草': 'gardening',
        '爱秀': 'iShow',
        '读书听歌看电影': 'LeisureTime',
        '无限影话': 'Movie',
        '天籁之音': 'Music',
        '乐手之家': 'MusicPlayer',
        '活动专区': 'MyActivity',
        '户外活动': 'Outdoors',
        '摄影学习': 'PhotoForum',
        '摄影器材': 'PhotoGear',
        '光影剪辑': 'PhotoProcessing',
        '贴图吧': 'Pics',
        '娱乐新闻': 'PopNews',
        '摇滚音乐': 'Rock',
        '音乐听堂': 'Sound_of_Music',
        '综艺乐翻天': 'Supershow',
        '四海为家': 'Travel',
        '中文电视': 'TVChinese',
        '视频游戏': 'TVGame',
        '手表': 'Watch',
        '未名水世界': 'WaterWorld',
        '未名网络电台': 'WebRadio',
        '谈婚论嫁': 'WeddingBells',
        '未名游戏': 'WmGame',
        '尊巴': 'Zumba'
    },
    '情感杂想': {
        '红茶馆&网友俱乐部': 'Banquet',
        '祝福': 'Blessing',
        '梦里花落知多少': 'Dreamer',
        '鸟语花香': 'EnglishChat',
        '两性平等': 'GenderEquality',
        '豆蔻年华': 'Girl',
        '心情好么': 'Heart',
        '肚皮舞运动': 'Joke',
        '同女之舞': 'LES',
        '情爱幽幽': 'Love',
        '男人': 'man',
        '如烟网事': 'Memory',
        '中学时代': 'MiddleSchool',
        '人到中年': 'Midlife',
        '心有所宠': 'pets',
        '鹊桥': 'Piebridge',
        '同志啊同志': 'Rainbow',
        '性意识': 'Sex',
        '性意识2': 'Sex2',
        '单身': 'single',
        '无心呢喃': 'Whisper',
    },
    '文学艺术': {
        '艺术殿堂': 'Arts',
        '宗教信仰': 'Belief',
        '中华古典文化': 'ChineseClassics',
        '一本漫画闯天涯': 'Comic',
        '风水研究': 'Fengshui',
        '兰若寺': 'Ghost',
        '读书听歌看电影': 'LeisureTime',
        '文海拾贝': 'Literature',
        '文情影色': 'LoveNLust',
        '歌剧“魅”影': 'OperaHouse',
        '谈古论金，黄梁一梦 ': 'paladin',
        '海棠诗社': 'Poetry',
        '散文.原创文学板': 'Prose',
        '心理分析': 'PsychoAnalysis',
        '气功': 'QiGong',
        '书香世家': 'Reader',
        '星际浪子 ': 'SciFiction',
        '性意识': 'Sex',
        '性意识2': 'Sex2',
        '思考者': 'Thoughts',
        '译林': 'Translation',
        '基督信仰': 'TrustInJesus',
        '佛道儒': 'Wisdom',
        '戏曲': 'Xiqu'
    },
    '校友联谊': {
        '中国科学院': 'AC',
        '安徽大学': 'AHU',
        '北京广播学院': 'BBI',
        '伯克利': 'Berkeley',
        '北京理工大学': 'BIT',
        '北京交通大学': 'BJTU',
        '北京工业大学': 'BJUT',
        '北京医科大学': 'BMU',
        '北京师范大学': 'BNU',
        '北京航空航天大学': 'BUAA',
        '北京化工大学': 'BUCT',
        '北京邮电大学': 'BUPT',
        '中国农业大学': 'CAU',
        '重庆大学': 'CQU',
        '中南大学': 'CSU',
        '中国政法大学': 'CUPL',
        '东华大学（原中纺大）': 'DHU',
        '大连理工大学': 'DUT',
        '华东师范大学': 'ECNU',
        '华东理工大学': 'ECUST',
        '复旦大学': 'FDU',
        '哈尔滨工业大学': 'HIT',
        '香港科技大学': 'HKUST',
        '湖大': 'HNU',
        '湖南大学': 'HuNaUuniversity',
        '华中科技大学': 'HUST',
        '吉林大学': 'JLU',
        '兰州大学': 'LZU',
        '华北电力大学': 'NCEPU',
        '台湾新竹交通大学': 'NCTU',
        '东北大学': 'NEU',
        '南京大学': 'NJU',
        '南开大学': 'NKU',
        '南京航空航天大学': 'NUAA',
        '南京理工大学': 'NUST',
        '西北工业大学': 'NWPU',
        '西北大学（中国）': 'NWU',
        '中国海洋大学': 'OUC',
        '北京大学': 'PKU',
        '普度大学': 'Purdue',
        '青岛大学': 'QDU',
        '人民大学': 'RUC',
        '四川大学': 'SCU',
        '华南理工': 'SCUT',
        '山东大学': 'SDU',
        '东南大学': 'SEU',
        '上海交通大学': 'SJTU',
        '苏州大学': 'SUDA',
        '西南交通大学': 'SWJTU',
        '清华大学': 'THU',
        '天津大学': 'TJU',
        '同济大学': 'TongJi',
        '电子科技大学': 'UESTC',
        '马里兰大学': 'UMD',
        '北京科技大学': 'USTB',
        '中国科学技术大学': 'USTC',
        '武汉大学': 'WHU',
        '西安电子科技大学': 'XiDian',
        '西安交通大学': 'XJTU',
        '厦门大学': 'XMU',
        '浙江大学': 'ZJU',
        '中山大学': 'ZSU'
    },
    '乡里乡情': {
        '皖风徽韵': 'Anhui',
        '我爱北京天安门': 'Beijing',
        '一盅两件': 'Cantonese',
        '黄桷树下': 'Chongqing',
        '巴山蜀水': 'ChuanYu',
        '八闽大地': 'Fujian',
        '八桂之乡': 'Guang_Xi',
        '你好海南': 'HAINAN',
        '长城内外': 'Hebei',
        '中原': 'Henan',
        '九头鸟': 'Hubei',
        '三湘四水': 'HuNan',
        '大漠绿野': 'InnerMongolia',
        '最忆是江南': 'Jiangnan',
        '江苏菜籽': 'Jiangsu',
        '江南西道': 'Jiangxi',
        '白山黑水': 'NorthEast',
        '三秦': 'Shaanxi',
        '齐鲁青未了': 'Shandong',
        '上海风情': 'Shanghai',
        '情系三晋': 'Shanxi',
        '西南': 'Southwest',
        '狗不理十八街耳朵眼': 'Tianjin',
        '西北望射天狼': 'Xibei',
        '浙江': 'Zhejiang'
    },
    '电脑网络': {
        '家有苹果': 'Apple',
        '网站建设': 'BuildingWeb',
        '电脑图形处理': 'ComputerGraphics',
        '计算机科学': 'CS',
        '数据库': 'Database',
        '数据科学': 'DataSciences',
        '窗口里的风景': 'DotNet',
        '热门网络技术': 'EmergingNetworking',
        '闪客一族': 'Flash',
        '虚拟人生': 'Game',
        '计算机硬件': 'Hardware',
        '有缘千里一线牵': 'Internet',
        '爪哇娇娃': 'Java',
        'Linux 操作系统': 'Linux',
        '移动开发': 'MobileDevelopment',
        '掌中宝': 'PDA',
        '葵花宝典': 'Programming',
        '科技新闻': 'ScitechNews',
        '系统安全': 'Security',
        '软件世界': 'Software',
        'TeX电子排版系统': 'TeX',
        '视频游戏': 'TVGame',
        '噫吁兮，危乎高哉': 'Unix',
        '看得见风景的窗口': 'Windows',
        '未名游戏': 'WmGame',
        'WWW明日之星': 'XML'
    },
    '学术学科': {
        '会计审计': 'Accounting',
        '精算': 'Actuary',
        '人类学和语言学': 'AnthroLing',
        '天文': 'Astronomy',
        '航空航天': 'Aviation',
        '生物学': 'Biology',
        '商学院': 'Business',
        '化学工程': 'ChemEng',
        '化学': 'Chemistry',
        '中国研究': 'China',
        '中医': 'ChineseMed',
        '土木工程': 'CivilEngineering',
        '科学计算': 'Computation',
        '数据科学': 'DataSciences',
        '经济': 'Economics',
        '教育学': 'Education',
        '电子工程': 'EE',
        '工程': 'Engineering',
        '环境科学与工程': 'Environmental',
        '地球与空间科学': 'GeoSpace',
        '律师事务所': 'Law',
        '高分子': 'Macromolecules',
        '数学': 'Mathematics',
        '机械工程': 'ME',
        '医学职业': 'MedicalCareer',
        '医疗器械': 'MedicalDevice',
        '医疗实践': 'Medicalpractice',
        '医学技师': 'Medicaltech',
        '纳米科技': 'NanoST',
        '神经科学': 'Neuroscience',
        '护理学': 'Nursing',
        '制药': 'Pharmaceutical',
        '药学': 'Pharmacy',
        '物理学': 'Physics',
        '政治学': 'PoliticalScience',
        '心理学': 'Psychology',
        '金融工程': 'Quant',
        '健康产品法规科学': 'RegulatoryAffairs',
        '自然科学': 'Science',
        '社会学': 'Sociology',
        '统计': 'Statistics'
    }
}


def mitbbs_spider(specific_board='JobHunting', max_pages=1, key_words=['']):
    results = {}
    key_words = key_words if type(key_words) == list else list(key_words)
    page = 0
    root_url = 'http://www.mitbbs.com'
    hdr = {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11',
               'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
               'Accept-Charset': 'ISO-8859-1,utf-8;q=0.7,*;q=0.3',
               'Accept-Encoding': 'none',
               'Accept-Language': 'en-US,en;q=0.8',
               'Connection': 'keep-alive'}
    while page < max_pages:
        try:
            page_num = page * 100 + 1
            url = root_url + '/bbsdoc1/' + specific_board + '_' + str(page_num) + '_0.html'
            req = urllib2.Request(url, headers=hdr)
            content = urllib2.urlopen(req).read()
            content = BeautifulSoup(content, from_encoding='GB18030')   # BeautifulSoup
            for link in content.findAll('a', {'class': 'news1'}):
                new_url = root_url + link.get('href')
                title = link.string
                if title is None:
                    continue
                for key_word in key_words:
                    if key_word in title:
                        results[str(page+1) + ': ' +title.strip(' \t\n\r')] = new_url
                        #print(title.strip(' \t\n\r') + '\n' + new_url)
                        break
        except:
            print "Unexpected error:", sys.exc_info()[0]
        page += 1
    return results


def get_all_values(main_board):
    result = []

    def get_all(root):
        if hasattr(root, 'keys'):
            for key in root.keys():
                get_all(root[key])
        else:
            result.append(root)
    get_all(main_board)
    return result


def get_all_keys(main_board):
    result = []

    def get_all(root):
        if hasattr(root, 'keys'):
            for key in root.keys():
                result.append(key)
                get_all(root[key])
    get_all(main_board)
    return result